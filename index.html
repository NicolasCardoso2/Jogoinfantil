<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Jogoinfantil</title>
        <link rel="icon" type="image/png" href="./assets/icon.png">
        <link rel="apple-touch-icon" href="./assets/icon.png">
        <!-- Carregamento da fonte Quicksand (amigÃ¡vel para crianÃ§as) -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
        <!-- Dev helper: block known PostHog endpoints to avoid noisy timeouts from injected analytics
             Remove this snippet in production or when debugging actual analytics. -->
        <script>
            (function(){
                const blocked = [/posthog\.com/i, /us\.i\.posthog\.com/i];
                const shouldBlock = (url)=> blocked.some(r=> r.test(url));

                // patch fetch
                if(window.fetch){
                    const _fetch = window.fetch.bind(window);
                    window.fetch = function(resource, init){
                        try{
                            const u = (typeof resource === 'string') ? resource : (resource && resource.url) || '';
                            if(shouldBlock(u)){
                                console.debug('[dev-block] blocked fetch to', u);
                                return new Promise(()=>{}); // never resolves to mimic timeout-less blockage
                            }
                        }catch(e){/* ignore */}
                        return _fetch(resource, init);
                    };
                }

                // patch XMLHttpRequest
                const _xhrOpen = XMLHttpRequest.prototype.open;
                XMLHttpRequest.prototype.open = function(method, url){
                    try{
                        if(shouldBlock(url)){
                            console.debug('[dev-block] blocked XHR to', url);
                            // set a flag so send() can noop
                            this._dev_blocked = true;
                        }
                    }catch(e){/* ignore */}
                    return _xhrOpen.apply(this, arguments);
                };
                const _xhrSend = XMLHttpRequest.prototype.send;
                XMLHttpRequest.prototype.send = function(){
                    if(this._dev_blocked){
                        // no-op: prevent network call
                        return;
                    }
                    return _xhrSend.apply(this, arguments);
                };
            })();
        </script>
        <style>
            /* Reset CSS: Please avoid making changes here unless you know what you're doing :) */
            *,
            *::before,
            *::after {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
    
            html, body {
                width: 100%;
                height: 100%;
            }
    
        body {
            line-height: 1;
            font-family: 'Quicksand', Arial, sans-serif;
            background-color: #f5f7fb;
        }            ol, ul {
                list-style: none;
            }
    
            img, video {
                max-width: 100%;
                height: auto;
                display: block;
            }
    
            a {
                text-decoration: none;
                color: inherit;
            }
        </style>
    </head>
    <body>
        <div id="game-container"></div>
        <script src="./phaser.js"></script>
        <script>
            // Global fixMojibake: tenta corrigir textos corrompidos (UTF-8 mal decodificado)
            window.fixMojibake = function(s){
                if (typeof s !== 'string') return s;
                try {
                    let out = s;
                    // RemoÃ§Ã£o de caracteres de substituiÃ§Ã£o e controles invisÃ­veis (preserva \n/\r/\t)
                    out = out.replace(/\uFFFD/g, '')
                             .replace(/[\u0000-\u001F]/g, (c) => (c === '\n' || c === '\r' || c === '\t') ? c : '');

                    // Sinais e aspas comuns
                    out = out.replace(/Ã¢â‚¬â€/g, 'â€”') // em dash
                             .replace(/Ã¢â‚¬â€œ/g, 'â€“') // en dash
                             .replace(/Ã¢â‚¬Å“/g, 'â€œ')
                             .replace(/Ã¢â‚¬|Ã¢â‚¬Â/g, 'â€')
                             .replace(/Ã¢â‚¬Ëœ/g, 'â€˜')
                             .replace(/Ã¢â‚¬â„¢/g, 'â€™')
                             .replace(/Ã¢â‚¬Â¢/g, 'â€¢');

                    // Acentos (pt-BR mais frequentes)
                    out = out.replace(/ÃƒÂ¡/g,'Ã¡').replace(/ÃƒÂ¢/g,'Ã¢').replace(/ÃƒÂ£/g,'Ã£').replace(/ÃƒÂ¤/g,'Ã¤')
                             .replace(/ÃƒÂ§/g,'Ã§').replace(/ÃƒÂ©/g,'Ã©').replace(/ÃƒÂª/g,'Ãª').replace(/ÃƒÂ­/g,'Ã­')
                             .replace(/ÃƒÂ³/g,'Ã³').replace(/ÃƒÂ´/g,'Ã´').replace(/ÃƒÂµ/g,'Ãµ').replace(/ÃƒÂº/g,'Ãº')
                             .replace(/ÃƒÂ¼/g,'Ã¼').replace(/ÃƒÂ±/g,'Ã±')
                             .replace(/Ãƒï¿½/g,'Ã').replace(/Ãƒâ€°/g,'Ã‰').replace(/ÃƒÂ/g,'Ã').replace(/Ãƒâ€œ/g,'Ã“')
                             .replace(/ÃƒÅ¡/g,'Ãš').replace(/Ãƒâ€¡/g,'Ã‡').replace(/Ãƒâ‚¬/g,'Ã€').replace(/Ãƒâ€š/g,'Ã‚')
                             .replace(/ÃƒÆ’/g,'Ãƒ').replace(/Ãƒâ€¢/g,'Ã•').replace(/ÃƒÅ“/g,'Ãœ').replace(/ÃƒË†/g,'Ãˆ')
                             .replace(/Ãƒâ„¢/g,'Ã™');

                    // Remover marcador "Ã‚" residual muito comum
                    out = out.replace(/Ã‚/g, '');

                    // CorreÃ§Ãµes de emojis corrompidos comuns nestes arquivos
                    out = out.replace(/dYZ%/g, 'âœ¨').replace(/dY\?\+/g, 'ðŸ…');

                    return out;
                } catch (_) {
                    return s;
                }
            };

            // Padroniza setText para sempre aplicar fixMojibake
            (function(){
                if (!window.Phaser || !Phaser.GameObjects || !Phaser.GameObjects.Text) return;
                const orig = Phaser.GameObjects.Text.prototype.setText;
                Phaser.GameObjects.Text.prototype.setText = function(value){
                    const fm = window.fixMojibake || (x=>x);
                    if (typeof value === 'string') value = fm(value);
                    else if (Array.isArray(value)) value = value.map(v => (typeof v === 'string' ? fm(v) : v));
                    return orig.call(this, value);
                };
            })();
        </script>
        <script type="module" src="./src/main.js"></script>
    </body>
    </html>
